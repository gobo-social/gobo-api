shards:
  id: &id
    id:
      description: The unique identifier for this resource.
      type: integer

  person_id: &person_id
    person_id:
      description: The unique ID for the person that owns this resource.
      type: integer

  timestamp: &timestamp
    created:
      description: The ISO 8601 timestamp this resource was created.
      type: string
    updated:
      description: The ISO 8601 timestamp this resource was updated.
      type: string

  linkCore: &linkCore
    origin_type:
      description: The type of resource that represents the origin of this edge.
      type: string
    origin_id:
      description: The unique identifier for the resource.
      type: integer
    target_type:
      description: The type of resource that represents the target of this edge.
      type: string
    target_id:
      description: The uniuqe identifier for the resource.
      type: integer
    name:
      description: The name that describes the type of edge between these resources.
      type: string

  link: &link
    type: object
    additionalProperties: false
    required: [ id, origin_type, origin_id, target_type, target_id, name ]
    properties:
      <<: *id
      <<: *linkCore
      <<: *timestamp

  personCore: &personCore
    name:
      description: Chosen display name for this person.
      type: string
    authority_id:
      description: The unique identifier for this person within the authentication authority
      type: string

  person: &person
    type: object
    additionalProperties: false
    required: [ id ]
    properties:
      <<: *id
      <<: *personCore
      <<: *timestamp

  identityCore: &identityCore
    <<: *person_id
    base_url:
      description: The base URL of the service provider of this identity.
      type: string
    profile_url:
      description: The URL pointing to this identity on the host provider.
      type: string
    profile_image:
      description: The URL pointing to this idenity profile picture on the host provider.
      type: string
    username:
      description: The username associated with this identity.
      type: string
    name:
      description: The display name associated with this identity.
      type: string
    oauth_token:
      description: The OAuth token associated with this identity.
      type: string
    oauth_token_secret:
      description: The OAuth secret token associated with this identity access.
      type: string

  identity: &identity
    type: object
    additionalProperties: false
    required: [id, person_id, base_url, username]
    properties:
      <<: *id
      <<: *identityCore
      <<: *timestamp

  registrationCore: &registrationCore
    <<: *person_id
    base_url:
      description: The base URL of the service provider of this registration.
      type: string
    oauth_token:
      description: The OAuth token associated with this registration.
      type: string
    oauth_token_secret:
      description: The OAuth secret token associated with this registration access.
      type: string
    state:
      description: The current state of the registration.
      type: string
   
  
  registration: &registration
    type: object
    additionalProperties: false
    required: [id, person_id, base_url]
    properties:
      <<: *id
      <<: *registrationCore
      <<: *timestamp

  mastodonClientCore: &mastodonClientCore
    base_url:
      description: The base URL of the service provider of this Mastodon client.
      type: string
    client_id:
      description: The OAuth client ID associated with this client.
      type: string
    client_secret:
      description: The OAuth client secret associated with this client.
      type: string   
  
  mastodonClient: &mastodonClient
    type: object
    additionalProperties: false
    required: [id, base_url]
    properties:
      <<: *id
      <<: *mastodonClientCore
      <<: *timestamp

  filterCore: &filterCore
    <<: *person_id
    category:
      description: Describes the type of filter and controls how it acts on the feed
      type: string
    word:
      description: Lists the keyword used in the filter.
      type: string

  filter: &filter
    type: object
    additionalProperties: false
    required: [id, person_id ]
    properties:
      <<: *id
      <<: *filterCore
      <<: *timestamp

  sourceCore: &sourceCore
    base_url:
      description: The base URL of the source, pointing to its platform
      type: string
    url:
      description: The full, unique URL for this source
      type: string
    username:
      description: The platform unique name for a source
      type: string
    name:
      description: The platform display name for a source
      type: string
    icon_url:
      type: string
    active:
      description: Flag to control whether this source is actively used to build feeds.
      type: boolean

  source: &source
    type: object
    additionalProperties: false
    required: [id]
    properties:
      <<: *id
      <<: *sourceCore
      <<: *timestamp


  postCore: &postCore
    source_id:
      description: The unique ID of the source for this post.
      type: integer
    base_url:
      description: The base URL for the platform that hosts this post.
      type: string
    platform_id:
      description: The ID of this post, unique to the platform that hosts it.
      type: string
    title:
      type: string
    content:
      type: string
    author:
      description: The URL of the author profile, hosted by the platform
      type: string
    url:
      description: The URL of the original post, hosted by the platform
      type: string
    visibility:
      description: Describes how publicly visible this post is
      type: string

  post: &post
    type: object
    additionalProperties: false
    required: [id]
    properties:
      <<: *id
      <<: *postCore
      <<: *timestamp

resources:
  discovery:
    template: /
    route: /
    methods:
      get:
        request:
          authorization: [ public ]
        response:
          type: application/json
          status: 200

  links:
    template: /links{?view,direction,per_page,page,origin_type,origin_id,target_type,target_id,name}
    route: /links
    methods:
      post:
        request:
          type: application/json
          schema:
            type: object
            additionalProperties: false
            required: [ origin_type, origin_id, target_type, target_id, name ]
            properties: *linkCore
        response:
          type: application/json
          schema: *link
          status: 201

      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema:
            type: array
            items: *link


  link:
    template: /links/{id}
    route: /links/<int:id>
    methods:
      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema: *link

      put:
        request:
          type: application/json
          schema: *link
        response:
          type: application/json
          status: 200
          schema: *link

      delete:
        request: {}
        response:
          status: 204


  people:
    template: /people{?view,direction,per_page,page}
    route: /people
    methods:
      post:
        request:
          type: application/json
          schema:
            type: object
            additionalProperties: false
            properties: *personCore
        response:
          type: application/json
          schema: *person
          status: 201

      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema:
            type: array
            items: *person


  person:
    template: /people/{id}
    route: /people/<int:id>
    methods:
      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema: *person

      put:
        request:
          type: application/json
          schema: *person
        response:
          type: application/json
          status: 200
          schema: *person

      delete:
        request: {}
        response:
          status: 204


  identities:
    template: /identities{?view,direction,per_page,page}
    route: /identities
    methods:
      post:
        request:
          type: application/json
          schema:
            type: object
            additionalProperties: false
            required: [person_id, base_url, username, profile_url]
            properties: *identityCore
        response:
          type: application/json
          schema: *identity
          status: 201

      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema:
            type: array
            items: *identity


  identity:
    template: /identities/{id}
    route: /identities/<int:id>
    methods:
      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema: *identity

      put:
        request:
          type: application/json
          schema: *identity
        response:
          type: application/json
          status: 200
          schema: *identity

      delete:
        request: {}
        response:
          status: 204

  registrations:
    template: /registrations{?view,direction,per_page,page}
    route: /registrations
    methods:
      post:
        request:
          type: application/json
          schema:
            type: object
            additionalProperties: false
            required: [person_id, base_url]
            properties: *registrationCore
        response:
          type: application/json
          schema: *registration
          status: 201

      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema:
            type: array
            items: *registration


  registration:
    template: /registrations/{id}
    route: /registrations/<int:id>
    methods:
      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema: *registration

      put:
        request:
          type: application/json
          schema: *registration
        response:
          type: application/json
          status: 200
          schema: *registration

      delete:
        request: {}
        response:
          status: 204


  mastodon_clients:
    template: /mastodon_clients{?view,direction,per_page,page}
    route: /mastodon_clients
    methods:
      post:
        request:
          type: application/json
          schema:
            type: object
            additionalProperties: false
            properties: *mastodonClientCore
        response:
          type: application/json
          schema: *mastodonClient
          status: 201

      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema:
            type: array
            items: *mastodonClient


  mastodon_client:
    template: /mastodon_clients/{id}
    route: /mastodon_clients/<int:id>
    methods:
      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema: *mastodonClient

      put:
        request:
          type: application/json
          schema: *mastodonClient
        response:
          type: application/json
          status: 200
          schema: *mastodonClient

      delete:
        request: {}
        response:
          status: 204

  filters:
    template: /filters{?view,direction,per_page,page}
    route: /filters
    methods:
      post:
        request:
          type: application/json
          schema:
            type: object
            additionalProperties: false
            properties: *filterCore
        response:
          type: application/json
          schema: *filter
          status: 201

      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema:
            type: array
            items: *filter


  filter:
    template: /filter/{id}
    route: /filter/<int:id>
    methods:
      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema: *filter

      put:
        request:
          type: application/json
          schema: *filter
        response:
          type: application/json
          status: 200
          schema: *filter

      delete:
        request: {}
        response:
          status: 204

  sources:
    template: /sources{?view,direction,per_page,page}
    route: /sources
    methods:
      post:
        request:
          type: application/json
          schema:
            type: object
            additionalProperties: false
            properties: *sourceCore
        response:
          type: application/json
          schema: *source
          status: 201

      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema:
            type: array
            items: *source


  source:
    template: /source/{id}
    route: /source/<int:id>
    methods:
      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema: *source

      put:
        request:
          type: application/json
          schema: *source
        response:
          type: application/json
          status: 200
          schema: *source

      delete:
        request: {}
        response:
          status: 204

  posts:
    template: /posts{?view,direction,per_page,page}
    route: /posts
    methods:
      post:
        request:
          type: application/json
          schema:
            type: object
            additionalProperties: false
            properties: *postCore
        response:
          type: application/json
          schema: *post
          status: 201

      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema:
            type: array
            items: *post


  post:
    template: /post/{id}
    route: /post/<int:id>
    methods:
      get:
        request: {}
        response:
          type: application/json
          status: 200
          schema: *post

      put:
        request:
          type: application/json
          schema: *post
        response:
          type: application/json
          status: 200
          schema: *post

      delete:
        request: {}
        response:
          status: 204

  me:
    template: /auth/me
    route: /auth/me
    methods:
      get:
        request:
          authorization:
            - general
        response:
          type: application/json
          status: 200
          schema: *person

      put:
        request:
          type: application/json
          schema: *person
        response:
          type: application/json
          status: 200
          schema: *person

  resources:
    template: /people/{id}/{resource_type}{?per_page,page}
    route: /people/<int:id>/<resource_type>
    methods:
      get:
        request:
          authorization:
            - person
        response:
          type: application/json
          status: 200
          schema:
            type: array
            items: 
              anyOf:
                - *identity
                - *filter
                - *source

  resource:
    template: /people/{id}/{resource_type}/{resource_id}
    route: /people/<int:id>/<resource_type>/<int:resource_id>
    methods:
      get:
        request:
          authorization:
            - person
        response:
          type: application/json
          status: 200

      put:
        request:
          authorization:
            - person
          type: application/json
        response:
          type: application/json
          status: 200

      delete:
        request:
          authorization:
            - person
        response:
          status: 204

      

  

  action_onboard_identity_start:
    template: /actions/onboard-identity
    route: /actions/onboard-identity
    methods:
      post:
        request:
          authorization:
            - general
        response:
          type: application/json
          status: 200
          schema:
            type: object
            additionalProperties: false
            required: [ redirectURL ]
            properties:
              redirectURL:
                description: The URL the GOBO client should redirect the browser so the person may login
                type: string

  action_onboard_identity_callback:
    template: /actions/onboard-identity-callback
    route: /actions/onboard-identity-callback
    methods:
      post:
        request:
          authorization:
            - general
        response:
          status: 204